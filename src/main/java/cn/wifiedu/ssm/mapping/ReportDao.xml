<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="report" >
  <resultMap id="BaseResultMap" type="java.util.HashMap" ></resultMap>
  <parameterMap id="BaseParameterMap" type="java.util.HashMap" ></parameterMap>
 	<!--通过科研主键查询开题报告  -->
	 <select id="findReportById" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
	 	select
	  		e.SC_EXPLORE_PK,
		 	e.STATUS,
		 	e.FK_EXPLORE_PETITION,
			e.FK_EXPLORE_PROGRESS,
			e.FK_PROJECT_ACHIEVE,
		   	r.EXPLORE_REPORT_PK,
			r.ACTIVITY_DESIGN,
			r.REPORT_POINT,
			r.REPORT_IMPORTANT_CHANGE,
			to_char(r.CREATE_TIME,'yyyy-MM-dd') CREATE_TIME,
			r.SCHOOL_CHECK_OPINION,
			r.AREA_CHECK_OPINION,
			r.SCHOOL_CHECK_RESULT,
			r.AREA_CHECK_RESULT,
			to_char(r.SCHOOL_CHECK_TIME,'yyyy-MM-dd') SCHOOL_CHECK_TIME,
			to_char(r.AREA_CHECK_TIME,'yyyy-MM-dd') AREA_CHECK_TIME,
			(select USER_SN from SC_CORE.SC_USER where USER_PK=r.SCHOOL_CHECK_USER) SCHOOL_CHECK_USER,
			(select USER_SN from SC_CORE.SC_USER where USER_PK=r.AREA_CHECK_USER) AREA_CHECK_USER,
			r.RES_FILE_LINK_PK,
			r.FILE_NAME,
			r.EXT_NAME,
			r.FILE_PATH,
			r.FILE_ID
			from SC_EXPLORE_REPORT r,SC_EXPLORE e
		 where r.EXPLORE_REPORT_PK=e.FK_EXPLORE_REPORT
	     and e.SC_EXPLORE_PK=#{SC_EXPLORE_PK}
	 	
	 	</select>
	 	
 	<!-- 添加开题报告 -->
 	<insert id="insertReport" parameterMap="BaseParameterMap">
 		insert into 
 			SC_EXPLORE_REPORT
 			(
 				EXPLORE_REPORT_PK,
				ACTIVITY_DESIGN,
				REPORT_POINT,
				REPORT_IMPORTANT_CHANGE,
				CREATE_TIME,
				RES_FILE_LINK_PK,
				FILE_NAME,
				EXT_NAME,
				FILE_PATH,
				FILE_ID,
				SCHOOL_CHECK_RESULT,
				AREA_CHECK_RESULT	
 			)
 		values
 			(
 				#{UUID},
 				#{ACTIVITY_DESIGN},
 				#{REPORT_POINT},
 				#{REPORT_IMPORTANT_CHANGE},
 				sysdate,
 				#{RES_FILE_LINK_PK,jdbcType=VARCHAR},
				#{FILE_NAME,jdbcType=VARCHAR},
				#{EXT_NAME,jdbcType=VARCHAR},
				#{FILE_PATH,jdbcType=VARCHAR},
				#{FILE_ID,jdbcType=VARCHAR},
 				#{SCHOOL_CHECK_RESULT},
 				#{AREA_CHECK_RESULT}
 			)
 	</insert>
 	
	<!-- 修改开题报告 -->
	<update id="updateReport" parameterMap="BaseParameterMap">
		update SC_EXPLORE_REPORT
			set 
				ACTIVITY_DESIGN=#{ACTIVITY_DESIGN},
				REPORT_POINT=#{REPORT_POINT},
				REPORT_IMPORTANT_CHANGE=#{REPORT_IMPORTANT_CHANGE},
				RES_FILE_LINK_PK=#{RES_FILE_LINK_PK,jdbcType=VARCHAR},
				FILE_NAME=#{FILE_NAME,jdbcType=VARCHAR},
				EXT_NAME=#{EXT_NAME,jdbcType=VARCHAR},
				FILE_PATH=#{FILE_PATH,jdbcType=VARCHAR},
				FILE_ID=#{FILE_ID,jdbcType=VARCHAR}
		where EXPLORE_REPORT_PK=#{EXPLORE_REPORT_PK}
	</update>

</mapper>