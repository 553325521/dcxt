<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mappea.dtd" >
<mapper namespace="alter" >
  <resultMap id="BaseResultMap" type="java.util.HashMap" ></resultMap>
  <parameterMap id="BaseParameterMap" type="java.util.HashMap" ></parameterMap>
 	<!-- 通过科研主键查询科研变更报告 -->
	 <select id="findAlterById" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
	 	select
	  		e.SC_EXPLORE_PK,
		 	e.STATUS,
		 	e.FK_EXPLORE_PETITION,
		 	e.FK_EXPLORE_REPORT,
			e.FK_EXPLORE_PROGRESS,
			e.FK_PROJECT_ACHIEVE,
			e.FK_EXPLORE_DELAY,
			e.FK_EXPLORE_ALTER,
			e.FK_EXPLORE_DELAY,
		   	a.EXPLORE_ALTER_PK,
		   	a.REASON,
			a.ALTER_CONTENT,
			a.OLD_STATUS,
			a.FZR_CHANGE,
			a.PROJECT_TITLE,
			a.EXPECT_RESULT,
			a.FK_TEACHER,
			a.TEACHER_NAME,
			a.TEACHER_GENDER,
			a.TEACHER_IDCARD,
			a.TEACHER_EMAIL,
			a.TEACHER_TEL,
			a.TEACHER_HOME_TEL,
			a.TEACHER_JOB,
			a.TEACHER_JOB_TITLE,
			a.TEACHER_SKILL,
			a.FK_TEACHER_SCHOOL,
			a.TEACHER_SCHOOL_NAME,
			a.TEACHER_SCHOOL_TEL,
			a.TEACHER_SCHOOL_ADDRESS,
			a.TEACHER_SCHOOL_POSTAL,
			a.BASIS_THEORY,
			a.PLANS,
			a.CONDITION,
			a.INFORMATION_REVIEW,
			a.DESIGN_ARGUMENT,
			a.OLD_PROJECT_NAME,
			a.OLD_EXPECT_RESULT,
			a.OLD_TEACHER_PK,
			a.OLD_TEACHER_NAME,
			a.OLD_TEACHER_GENDER,
			a.OLD_TEACHER_IDCARD,
			a.OLD_TEACHER_EMAIL, 
			a.OLD_TEACHER_TEL,
			a.OLD_TEACHER_HOME_TEL,
			a.OLD_TEACHER_JOB,
			a.OLD_TEACHER_JOB_TITLE,
			a.OLD_TEACHER_SKILL,
			a.OLD_SCHOOL_PK,
			a.OLD_SCHOOL_NAME,
			a.OLD_SCHOOL_TEL,
			a.OLD_SCHOOL_ADDRESS,
			a.OLD_SCHOOL_POSTAL,
			a.OLD_BASIS_THEORY,
			a.OLD_PLANS,
			a.OLD_CONDITION,
			a.OLD_INFORMATION_REVIEW,
			a.OLD_DESIGN_ARGUMENT,
			to_char(a.CREATE_TIME,'yyyy-MM-dd') CREATE_TIME,
			a.SCHOOL_CHECK_OPINION,
			a.AREA_CHECK_OPINION,
			a.SCHOOL_CHECK_RESULT,
			a.AREA_CHECK_RESULT,
			a.RES_FILE_LINK_PK,
			a.FILE_NAME,
			a.EXT_NAME,
			a.FILE_PATH,
			a.FILE_ID
			from SC_EXPLORE_ALTER a,SC_EXPLORE e
		 where a.EXPLORE_ALTER_PK=e.FK_EXPLORE_ALTER
	     and e.SC_EXPLORE_PK=#{SC_EXPLORE_PK}
	 	</select>
	 	
	 	<!-- 通过变更报告主键查询科研变更报告 -->
	 <select id="findAlterInfoByPk" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
	 	select
	  		e.SC_EXPLORE_PK,
		 	e.STATUS,
		 	e.FK_EXPLORE_PETITION,
		 	e.FK_EXPLORE_REPORT,
			e.FK_EXPLORE_PROGRESS,
			e.FK_PROJECT_ACHIEVE,
			e.FK_EXPLORE_DELAY,
			e.FK_EXPLORE_ALTER,
			e.FK_EXPLORE_DELAY,
		   	a.EXPLORE_ALTER_PK,
		   	a.REASON,
			a.ALTER_CONTENT,
			a.OLD_STATUS,
			a.FZR_CHANGE,
			a.PROJECT_TITLE,
			a.EXPECT_RESULT,
			a.FK_TEACHER,
			a.TEACHER_NAME,
			a.TEACHER_GENDER,
			a.TEACHER_IDCARD,
			a.TEACHER_EMAIL,
			a.TEACHER_TEL,
			a.TEACHER_HOME_TEL,
			a.TEACHER_JOB,
			a.TEACHER_JOB_TITLE,
			a.TEACHER_SKILL,
			a.FK_TEACHER_SCHOOL,
			a.TEACHER_SCHOOL_NAME,
			a.TEACHER_SCHOOL_TEL,
			a.TEACHER_SCHOOL_ADDRESS,
			a.TEACHER_SCHOOL_POSTAL,
			a.BASIS_THEORY,
			a.PLANS,
			a.CONDITION,
			a.INFORMATION_REVIEW,
			a.DESIGN_ARGUMENT,
			a.FK_EXPLORE,
			a.OLD_PROJECT_NAME,
			a.OLD_EXPECT_RESULT,
			a.OLD_TEACHER_PK,
			a.OLD_TEACHER_NAME,
			a.OLD_TEACHER_GENDER,
			a.OLD_TEACHER_IDCARD,
			a.OLD_TEACHER_EMAIL, 
			a.OLD_TEACHER_TEL,
			a.OLD_TEACHER_HOME_TEL,
			a.OLD_TEACHER_JOB,
			a.OLD_TEACHER_JOB_TITLE,
			a.OLD_TEACHER_SKILL,
			a.OLD_SCHOOL_PK,
			a.OLD_SCHOOL_NAME,
			a.OLD_SCHOOL_TEL,
			a.OLD_SCHOOL_ADDRESS,
			a.OLD_SCHOOL_POSTAL,
			a.OLD_BASIS_THEORY,
			a.OLD_PLANS,
			a.OLD_CONDITION,
			a.OLD_INFORMATION_REVIEW,
			a.OLD_DESIGN_ARGUMENT,
			to_char(a.CREATE_TIME,'yyyy-MM-dd') CREATE_TIME,
			a.SCHOOL_CHECK_OPINION,
			a.AREA_CHECK_OPINION,
			a.SCHOOL_CHECK_RESULT,
			a.AREA_CHECK_RESULT,
			a.RES_FILE_LINK_PK,
			a.FILE_NAME,
			a.EXT_NAME,
			a.FILE_PATH,
			a.FILE_ID
			from SC_EXPLORE_ALTER a,SC_EXPLORE e
		 where a.EXPLORE_ALTER_PK=e.FK_EXPLORE_ALTER
	     and a.EXPLORE_ALTER_PK=#{EXPLORE_ALTER_PK}
	     <!-- and a.FK_EXPLORE=#{EXPLORE_PK} -->
	 	</select>
	 	
 	<!-- 新增科研变更报告  -->
 	<!--负责人不变  -->
 	<insert id="insertAlterNoChange" parameterMap="BaseParameterMap">
 		insert into 
 			SC_EXPLORE_ALTER
 			(
 				EXPLORE_ALTER_PK,
				REASON,
				ALTER_CONTENT,
				OLD_STATUS,
				FZR_CHANGE,
				PROJECT_TITLE,
				EXPECT_RESULT,
				FK_TEACHER,
				TEACHER_NAME,
				TEACHER_GENDER,
				TEACHER_IDCARD,
				TEACHER_EMAIL,
				TEACHER_TEL,
				TEACHER_HOME_TEL,
				TEACHER_JOB,
				TEACHER_JOB_TITLE,
				TEACHER_SKILL,
				FK_TEACHER_SCHOOL,
				TEACHER_SCHOOL_NAME,
				TEACHER_SCHOOL_TEL,
				TEACHER_SCHOOL_ADDRESS,
				TEACHER_SCHOOL_POSTAL,
				BASIS_THEORY,
				PLANS,
				CONDITION,
				INFORMATION_REVIEW,
				DESIGN_ARGUMENT,
				OLD_PROJECT_NAME,
				OLD_EXPECT_RESULT,
				OLD_TEACHER_PK,
				OLD_TEACHER_NAME,
				OLD_TEACHER_GENDER,
				OLD_TEACHER_IDCARD,
				OLD_TEACHER_EMAIL,
				OLD_TEACHER_TEL,
				OLD_TEACHER_HOME_TEL, 
				OLD_TEACHER_JOB ,
				OLD_TEACHER_JOB_TITLE ,
				OLD_TEACHER_SKILL ,
				OLD_SCHOOL_PK,
				OLD_SCHOOL_NAME,
				OLD_SCHOOL_TEL,
				OLD_SCHOOL_ADDRESS,
				OLD_SCHOOL_POSTAL,
				OLD_BASIS_THEORY,
				OLD_PLANS,
				OLD_CONDITION,
				OLD_INFORMATION_REVIEW,
				OLD_DESIGN_ARGUMENT,
				FK_EXPLORE,
				CREATE_TIME,
				RES_FILE_LINK_PK,
				FILE_NAME,
				EXT_NAME,
				FILE_PATH,
				FILE_ID,
				SCHOOL_CHECK_RESULT,
				AREA_CHECK_RESULT
 			)
 		values
 			(
 				#{UUID},
 				#{REASON},
 				#{ALTER_CONTENT},
 				#{OLD_STATUS},
 				#{FZR_CHANGE},
 				#{PROJECT_NAME},
 				#{EXPECT_RESULT},
 				#{FK_TEACHER},
 				#{TEACHER_NAME},
 				#{TEACHER_GENDER},
 				#{TEACHER_IDCARD},
 				#{TEACHER_EMAIL},
 				#{TEACHER_TEL},
 				#{TEACHER_HOME_TEL},
 				#{TEACHER_JOB},
 				#{TEACHER_JOB_TITLE},
 				#{TEACHER_SKILL},
 				#{FK_TEACHER_SCHOOL},
 				#{TEACHER_SCHOOL_NAME},
 				#{TEACHER_SCHOOL_TEL},
 				#{TEACHER_SCHOOL_ADDRESS},
 				#{TEACHER_SCHOOL_POSTAL},
 				#{BASIS_THEORY},
 				#{PLANS},
 				#{CONDITION},
 				#{INFORMATION_REVIEW},
 				#{DESIGN_ARGUMENT},
 				#{PROJECT_NAME},
 				#{EXPECT_RESULT},
 				#{FK_TEACHER},
 				#{TEACHER_NAME},
 				#{TEACHER_GENDER},
 				#{TEACHER_IDCARD},
 				#{TEACHER_EMAIL},
 				#{TEACHER_TEL},
 				#{TEACHER_HOME_TEL},
 				#{TEACHER_JOB},
 				#{TEACHER_JOB_TITLE},
 				#{TEACHER_SKILL},
 				#{FK_TEACHER_SCHOOL},
 				#{TEACHER_SCHOOL_NAME},
 				#{TEACHER_SCHOOL_TEL},
 				#{TEACHER_SCHOOL_ADDRESS},
 				#{TEACHER_SCHOOL_POSTAL},
 				#{BASIS_THEORY},
 				#{PLANS},
 				#{CONDITION},
 				#{INFORMATION_REVIEW},
 				#{DESIGN_ARGUMENT},
 				#{SC_EXPLORE_PK},
 				sysdate,
 				#{RES_FILE_LINK_PK,jdbcType=VARCHAR},
				#{FILE_NAME,jdbcType=VARCHAR},
				#{EXT_NAME,jdbcType=VARCHAR},
				#{FILE_PATH,jdbcType=VARCHAR},
				#{FILE_ID,jdbcType=VARCHAR},
 				'0',
 				'0'	
 			)
 	</insert>
 	
 	<!--负责人改变  -->
 	<insert id="insertAlterChange" parameterMap="BaseParameterMap">
 		insert into 
 			SC_EXPLORE_ALTER
 			(
 				EXPLORE_ALTER_PK,
				REASON,
				ALTER_CONTENT,
				OLD_STATUS,
				FZR_CHANGE,
				PROJECT_TITLE,
				EXPECT_RESULT,
				FK_TEACHER,
				TEACHER_NAME,
				TEACHER_GENDER,
				TEACHER_IDCARD,
				TEACHER_EMAIL,
				TEACHER_TEL,
				TEACHER_HOME_TEL,
				TEACHER_JOB,
				TEACHER_JOB_TITLE,
				TEACHER_SKILL,
				FK_TEACHER_SCHOOL,
				TEACHER_SCHOOL_NAME,
				TEACHER_SCHOOL_TEL,
				TEACHER_SCHOOL_ADDRESS,
				TEACHER_SCHOOL_POSTAL,
				BASIS_THEORY,
				PLANS,
				CONDITION,
				INFORMATION_REVIEW,
				DESIGN_ARGUMENT,
				OLD_PROJECT_NAME,
				OLD_EXPECT_RESULT,
				OLD_TEACHER_PK,
				OLD_TEACHER_NAME,
				OLD_TEACHER_GENDER,
				OLD_TEACHER_IDCARD,
				OLD_TEACHER_EMAIL,
				OLD_TEACHER_TEL,
				OLD_TEACHER_HOME_TEL, 
				OLD_TEACHER_JOB ,
				OLD_TEACHER_JOB_TITLE ,
				OLD_TEACHER_SKILL ,
				OLD_SCHOOL_PK,
				OLD_SCHOOL_NAME,
				OLD_SCHOOL_TEL,
				OLD_SCHOOL_ADDRESS,
				OLD_SCHOOL_POSTAL,
				OLD_BASIS_THEORY,
				OLD_PLANS,
				OLD_CONDITION,
				OLD_INFORMATION_REVIEW ,
				OLD_DESIGN_ARGUMENT ,
				FK_EXPLORE,
				CREATE_TIME,
				RES_FILE_LINK_PK,
				FILE_NAME,
				EXT_NAME,
				FILE_PATH,
				FILE_ID,
				SCHOOL_CHECK_RESULT,
				AREA_CHECK_RESULT	
 			)
 		values
 			(
 				#{UUID},
 				#{REASON},
 				#{ALTER_CONTENT},
 				#{OLD_STATUS},
 				#{FZR_CHANGE},
 				#{PROJECT_NAME},
 				#{EXPECT_RESULT},
 				#{USER_PK},
 				#{TEACHER_NAME},
 				#{TEACHER_GENDER},
 				#{TEACHER_IDCARD},
 				#{TEACHER_EMAIL,jdbcType=VARCHAR},
 				#{TEACHER_TEL,jdbcType=VARCHAR},
 				#{TEACHER_HOME_TEL,jdbcType=VARCHAR},
 				#{TEACHER_JOB,jdbcType=VARCHAR},
 				#{TEACHER_JOB_TITLE,jdbcType=VARCHAR},
 				#{TEACHER_SKILL,jdbcType=VARCHAR},
 				#{SCHOOL_PK},
 				#{TEACHER_SCHOOL_NAME},
 				#{TEACHER_SCHOOL_TEL,jdbcType=VARCHAR},
 				#{TEACHER_SCHOOL_ADDRESS},
 				#{TEACHER_SCHOOL_POSTAL,jdbcType=VARCHAR},
 				#{BASIS_THEORY},
 				#{PLANS},
 				#{CONDITION},
 				#{INFORMATION_REVIEW},
 				#{DESIGN_ARGUMENT},
 				#{OLD_PROJECT_NAME},
 				#{OLD_EXPECT_RESULT},
 				#{OLD_TEACHER_PK},
 				#{OLD_TEACHER_NAME},
				#{OLD_TEACHER_GENDER},
				#{OLD_TEACHER_IDCARD},
				#{OLD_TEACHER_EMAIL,jdbcType=VARCHAR},
				#{OLD_TEACHER_TEL,jdbcType=VARCHAR},
				#{OLD_TEACHER_HOME_TEL,jdbcType=VARCHAR},
				#{OLD_TEACHER_JOB,jdbcType=VARCHAR},
				#{OLD_TEACHER_JOB_TITLE,jdbcType=VARCHAR},
				#{OLD_TEACHER_SKILL,jdbcType=VARCHAR},
				#{OLD_SCHOOL_PK},
				#{OLD_SCHOOL_NAME},
				#{OLD_SCHOOL_TEL,jdbcType=VARCHAR},
				#{OLD_SCHOOL_ADDRESS},
				#{OLD_SCHOOL_POSTAL,jdbcType=VARCHAR},
				#{OLD_BASIS_THEORY},
				#{OLD_PLANS},
				#{OLD_CONDITION},
				#{OLD_INFORMATION_REVIEW},
				#{OLD_DESIGN_ARGUMENT },
 				#{FK_EXPLORE},
 				sysdate,
 				#{RES_FILE_LINK_PK,jdbcType=VARCHAR},
				#{FILE_NAME,jdbcType=VARCHAR},
				#{EXT_NAME,jdbcType=VARCHAR},
				#{FILE_PATH,jdbcType=VARCHAR},
				#{FILE_ID,jdbcType=VARCHAR},
 				'0',
 				'0'	
 			)
 	</insert>
 	<!-- 变更报告新增科研成员  -->
 	 <insert id="insertAlterMember" parameterMap="BaseParameterMap">
  		insert into SC_MEMBER
  		(
  			MEMBER_PK,
			TEACHER_NAME,
			FK_TEACHER,
			GENDER,
			BORN,
			JOB_TITLE,
			SPECIALTY,
			FK_TEACHER_UNIT,
			UNIT_NAME,
			FK_EXPLORE,
			TEACHER_EDUCATION,
			TEACHER_DEGREE,
			TEACHER_WORK,
			FK_EXPLORE_ALTER,
			ALTER_SORT		
  		)
  		values(
  			#{UUID},
  			#{MEMBER_NAME},
  			#{MEMBER_USER_PK},
  			#{MEMBER_GENDER},
  			#{BORN},
  			#{JOB_TITLE},
  			#{SPECIALTY},
  			#{MEMBER_SCHOOL_PK},
  			#{MEMBER_SCHOOL_NAME},
  			#{FK_EXPLORE},
  			#{TEACHER_EDUCATION},
  			#{TEACHER_DEGREE},
  			#{TEACHER_WORK,jdbcType=VARCHAR},
  			#{FK_EXPLORE_ALTER},
  			#{ALTER_SORT}		
  		)
  	</insert>
 	<!-- 变更报告修改科研成员 -->
 		<update id="updateAlterMemeber" parameterMap="BaseParameterMap">
 			update SC_MEMBER
 			set ALTER_SORT=#{ALTER_SORT},
 				FK_EXPLORE_ALTER=#{FK_EXPLORE_ALTER}
 			where MEMBER_PK=#{MEMBER_PK}
 		</update>
 		
 		<!-- 变更报告新增负责人和成员近年研究课题-->
 		<insert id="insertAlterTask" parameterMap="BaseParameterMap">
  		insert into  SC_MEMBER_PROJECT
  		(
  			MEMBER_PROJECT_PK,
			PROJECT_NAME,
			PROJECT_TYPE,
			APPLY_DATE,
			COMPLETION,
			APPROVE_UNIT,
			FK_EXPLORE,
			FK_EXPLORE_ALTER,
			ALTER_SORT	
		)
  		values(
  			#{UUID},
  			#{PROJECT_NAME},
  			#{PROJECT_KIND},
  			to_date(#{START_DATE},'yyyy-MM-dd'),
  			#{COMPLETION},
  			#{APPROVE_UNIT},
  			#{FK_EXPLORE},
  			#{FK_EXPLORE_ALTER},
  			#{ALTER_SORT}
  		)
  </insert>
 		<!--变更报告修改负责人和成员近年研究课题  -->
 		<update id="updateAlterTask" parameterMap="BaseParameterMap">
 			update SC_MEMBER_PROJECT
 			set ALTER_SORT=#{ALTER_SORT},
 				FK_EXPLORE_ALTER=#{FK_EXPLORE_ALTER}
 			where MEMBER_PROJECT_PK=#{MEMBER_PROJECT_PK}
 		</update>
 	
 	<insert id="insertAlterResult" parameterMap="BaseParameterMap">
  	insert into SC_MEMBER_EXPECTING
  		(
  			MEMBER_EXPECTING_PK,
			TEACHER_ID,
			TEACHER_NAME,
			STAGE_START_TIME,
			RESULT_FORM,
			RESULT_STAGE_NAME,
			FK_EXPLORE,
			FK_EXPLORE_ALTER,
			ALTER_SORT,		
			STAGE_END_TIME
		)
  		values(
  			#{UUID},
  			#{PEOPLE_PK},
  			#{PEOPLE_NAME},
  			to_date(#{STAGE_START_TIME},'yyyy-MM-dd'),
  			#{RESULT_FORM},
  			#{RESULT_STAGE_NAME},
  			#{FK_EXPLORE},
  			#{FK_EXPLORE_ALTER},
  			#{ALTER_SORT},
  			to_date(#{STAGE_END_TIME},'yyyy-MM-dd')		
  		)
  </insert>
 	<!-- 变更报告修改预期研究成果 -->
 	<update id="updateAlterResult" parameterMap="BaseParameterMap">
 			update SC_MEMBER_EXPECTING
 			set ALTER_SORT=#{ALTER_SORT},
 				FK_EXPLORE_ALTER=#{FK_EXPLORE_ALTER}
 			where MEMBER_EXPECTING_PK=#{MEMBER_EXPECTING_PK}
 	</update>
 	
<!-- 修改科研变更报告  -->
	<update id="updateAlterByPk" parameterMap="BaseParameterMap">
		update SC_EXPLORE_ALTER
			set 
				REASON=#{REASON},
				ALTER_CONTENT=#{ALTER_CONTENT},
				PROJECT_TITLE=#{PROJECT_TITLE},
				EXPECT_RESULT=#{EXPECT_RESULT},
				FK_TEACHER=#{FK_TEACHER},
				TEACHER_NAME=#{TEACHER_NAME},
				TEACHER_GENDER=#{TEACHER_GENDER},
				TEACHER_IDCARD=#{TEACHER_IDCARD},
				TEACHER_EMAIL=#{TEACHER_EMAIL,jdbcType=VARCHAR},
				TEACHER_TEL=#{TEACHER_TEL,jdbcType=VARCHAR},
				TEACHER_HOME_TEL=#{TEACHER_HOME_TEL,jdbcType=VARCHAR},
				TEACHER_JOB=#{TEACHER_JOB,jdbcType=VARCHAR},
				TEACHER_JOB_TITLE=#{TEACHER_JOB_TITLE,jdbcType=VARCHAR},
				TEACHER_SKILL=#{TEACHER_SKILL,jdbcType=VARCHAR},
				FK_TEACHER_SCHOOL=#{FK_TEACHER_SCHOOL},
				TEACHER_SCHOOL_NAME=#{TEACHER_SCHOOL_NAME},
				TEACHER_SCHOOL_TEL=#{TEACHER_SCHOOL_TEL,jdbcType=VARCHAR},
				TEACHER_SCHOOL_ADDRESS=#{TEACHER_SCHOOL_ADDRESS},
				TEACHER_SCHOOL_POSTAL=#{TEACHER_SCHOOL_POSTAL,jdbcType=VARCHAR},
				BASIS_THEORY=#{BASIS_THEORY},
				PLANS=#{PLANS},
				CONDITION=#{CONDITION},
				INFORMATION_REVIEW=#{INFORMATION_REVIEW},
				DESIGN_ARGUMENT=#{DESIGN_ARGUMENT}
		where EXPLORE_ALTER_PK=#{EXPLORE_ALTER_PK}		
	</update>

	<!--添加到审核表  -->
	<insert id="insertCheck" parameterMap="BaseParameterMap">
		insert into 
			SC_EXPLORE_CHECK
			(
			CHECK_PK,
			CHECK_FLAG,
			CHECK_OPINION,
			CHECK_DATE,
			CHECK_USER,
			CHECK_LEVEL,
			FK_EXPLORE,
			CHECK_USER_NAME
			)
	values(
			#{UUID},
			#{CHECK_FLAG},
			#{CHECK_OPINION,jdbcType=VARCHAR},
			sysdate,
			#{userInfo.GUID},
			#{CHECK_LEVEL},
			#{SC_EXPLORE_PK},
			#{userInfo.XM}
	)
	</insert>

</mapper>