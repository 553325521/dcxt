<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="order">
	<resultMap id="BaseResultMap" type="java.util.HashMap"></resultMap>
	<parameterMap id="BaseParameterMap" type="java.util.HashMap"></parameterMap>
	<!-- 查询未支付与支付分别订单数量 -->
	<select id="selectOrderNumber" parameterMap="BaseParameterMap"
		resultMap="BaseResultMap">
		select
		o.ORDER_PAY_STATE,count(*) as ORDER_NUMBER
		from sc_order o
		WHERE (o.ORDER_DIVISION = '0' OR o.ORDER_DIVISION = '2')
		AND str_to_date(CREATE_TIME,'%Y-%m-%d %H:%i')
		BETWEEN str_to_date(#{CREATE_TIME},'%Y-%m-%d %H:%i')
		AND str_to_date(#{END_TIME},'%Y-%m-%d %H:%i')
		AND FK_SHOP = #{FK_SHOP}
		group by o.ORDER_PAY_STATE
	</select>
	<!-- 根据时间查询订单 -->
	<select id="selectOrderByTime" parameterMap="BaseParameterMap"
		resultMap="BaseResultMap">
		select o.ORDER_PK,
		(select t.TABLES_NAME   from sc_tables t where 
			t.TABLES_PK = o.ORDER_POSITION
		 ) AS ORDER_POSITION,o.ORDER_PAY_WAY,o.ORDER_DIVISION,
		o.ORDER_CODE,o.ORDER_RS,o.ORDER_PAY_STATE,o.ORDER_STATE,
		o.ARRIVE_TIME,o.CREATE_TIME,o.CREATE_BY,
		SUM(od.ORDER_DETAILS_FS) AS TOTAL_FS,
		SUM(od.ORDER_DETAILS_GMONEY/100*od.ORDER_DETAILS_FS) AS TOTAL_MONEY
		from SC_ORDER o left join SC_ORDER_DETAILS od
		on
		o.ORDER_PK = od.FK_ORDER
		WHERE
		(o.ORDER_DIVISION = '0' OR o.ORDER_DIVISION = '2')
		AND str_to_date(CREATE_TIME,'%Y-%m-%d
		%H:%i')
		BETWEEN str_to_date(#{CREATE_TIME},'%Y-%m-%d %H:%i')
		AND str_to_date(#{END_TIME},'%Y-%m-%d %H:%i')
		<if test="ORDER_PAY_STATE != null">
			AND ORDER_PAY_STATE = #{ORDER_PAY_STATE}
		</if>
		AND FK_SHOP = #{FK_SHOP}
		GROUP BY od.FK_ORDER
		ORDER BY
		str_to_date(CREATE_TIME,'%Y-%m-%d %H:%i:%s') DESC
	</select>
	<!-- 根据选择商铺、时间、支付方式查询订单 -->
	<select id="selectOrderByShopOrTimeOrPayWay" parameterMap="BaseParameterMap"
		resultMap="BaseResultMap">
		select o.ORDER_PK,
		(select t.TABLES_NAME   from sc_tables t where 
			t.TABLES_PK = o.ORDER_POSITION
		 ) AS ORDER_POSITION,o.ORDER_PAY_WAY,
		o.ORDER_CODE,o.ORDER_RS,o.ORDER_PAY_STATE,o.ORDER_STATE,
		o.ARRIVE_TIME,o.CREATE_TIME,o.CREATE_BY,
		SUM(od.ORDER_DETAILS_FS) AS TOTAL_FS,
		SUM(od.ORDER_DETAILS_GMONEY/100*od.ORDER_DETAILS_FS) AS TOTAL_MONEY
		from SC_ORDER o left join SC_ORDER_DETAILS od
		on
		o.ORDER_PK = od.FK_ORDER
		WHERE str_to_date(o.CREATE_TIME,'%Y-%m-%d%H:%i')
		BETWEEN str_to_date(#{START_TIME},'%Y-%m-%d %H:%i')
		AND str_to_date(#{END_TIME},'%Y-%m-%d %H:%i')
		AND o.ORDER_PAY_STATE = '1'
		AND o.ORDER_PAY_WAY = #{ORDER_PAY_WAY}
		AND FK_SHOP = #{FK_SHOP}
		GROUP BY od.FK_ORDER
		ORDER BY
		str_to_date(CREATE_TIME,'%Y-%m-%d %H:%i:%s') DESC
	</select>
	<!-- 根据订单ID查询订单总金额 -->
	<select id="selectOrderTotalMoneyByOrderPK" parameterMap="BaseParameterMap" resultMap="BaseResultMap">
		select 	SUM(od.ORDER_DETAILS_GMONEY/100*od.ORDER_DETAILS_FS) AS TOTAL_MONEY
		from SC_ORDER o left join SC_ORDER_DETAILS od
		on o.ORDER_PK = od.FK_ORDER
		WHERE o.ORDER_PK = #{ORDER_PK}
		GROUP BY od.FK_ORDER
	</select>
	
	
 	<!-- 根据订单id查询订单详情 -->
 	<select id="selectOrderDetailByOrderPK" parameterMap="BaseParameterMap" resultMap="BaseResultMap">
 		select 	o.ORDER_PK,
 			(select t.TABLES_NAME from sc_tables t where 
			t.TABLES_PK = o.ORDER_POSITION
		 	) AS ORDER_POSITION,o.ORDER_PAY_WAY,
			o.ORDER_CODE,o.ORDER_RS,o.ORDER_PAY_STATE,o.ORDER_STATE,o.ORDER_MLMONEY,o.ORDER_JFDXMONEY,o.ORDER_YHMONEY,o.ORDER_YFMONEY,o.ORDER_SHOPMONEY,
			o.ARRIVE_TIME,o.CREATE_TIME,
			od.ORDER_DETAILS_PK,od.ORDER_DETAILS_GNAME,
			od.ORDER_DETAILS_GMONEY,od.ORDER_DETAILS_GOODS_STATE,od.ORDER_DETAILS_FS
		from SC_ORDER o left join SC_ORDER_DETAILS od
		on o.ORDER_PK = od.FK_ORDER
		WHERE o.ORDER_PK =
		#{ORDER_PK}
		<!-- AND od.ORDER_DETAILS_GOODS_STATE != '3' -->
	</select>
	
	 	<!-- 根据订单id查询订单详情(订单具体信息，包括订单所在桌位的信息),结果以集合里边放集合返回 -->
 	<select id="selectOrderDetailTableByOrderPK" resultMap="orderTableDetail">
 		select ood.ORDER_PK,ood.ORDER_PAY_WAY,
			ood.ORDER_CODE,ood.ORDER_RS,ood.ORDER_PAY_STATE,ood.ORDER_STATE,ood.ORDER_MLMONEY,ood.ORDER_JFDXMONEY,ood.ORDER_YHMONEY,ood.ORDER_YFMONEY,ood.ORDER_SHOPMONEY,
			ood.ARRIVE_TIME,ood.CREATE_TIME,
			ood.ORDER_DETAILS_PK,ood.ORDER_DETAILS_GNAME,
			ood.ORDER_DETAILS_GMONEY,ood.ORDER_DETAILS_FS,t.TABLES_PK,t.TABLES_NAME,t.TABLES_NUM,t.TABLES_SHORT_NAME FROM (select 	o.ORDER_PK,
 			o.ORDER_POSITION,o.ORDER_PAY_WAY,
			o.ORDER_CODE,o.ORDER_RS,o.ORDER_PAY_STATE,o.ORDER_STATE,o.ORDER_MLMONEY,o.ORDER_JFDXMONEY,o.ORDER_YHMONEY,o.ORDER_YFMONEY,o.ORDER_SHOPMONEY,
			o.ARRIVE_TIME,o.CREATE_TIME,
			od.ORDER_DETAILS_PK,od.ORDER_DETAILS_GNAME,
			od.ORDER_DETAILS_GMONEY,od.ORDER_DETAILS_FS
		from SC_ORDER o left join SC_ORDER_DETAILS od
		on o.ORDER_PK = od.FK_ORDER
		WHERE o.ORDER_PK =
		#{ORDER_PK}) ood LEFT JOIN sc_tables t ON t.TABLES_PK = ood.ORDER_POSITION;
	</select>
	
	<resultMap id="orderTableDetail" type="java.util.HashMap">
            <id column="ORDER_PK" property="ORDER_PK"/>
            <result column="ORDER_PAY_WAY" property="ORDER_PAY_WAY"/>
            <result column="ORDER_CODE" property="ORDER_CODE"/>
            <result column="ORDER_RS" property="ORDER_RS"/>
            <result column="ORDER_PAY_STATE" property="ORDER_PAY_STATE"/>
            <result column="ORDER_STATE" property="ORDER_STATE"/>
            <result column="ORDER_MLMONEY" property="ORDER_MLMONEY"/>
            <result column="ORDER_JFDXMONEY" property="ORDER_JFDXMONEY"/>
            <result column="ORDER_YHMONEY" property="ORDER_YHMONEY"/>
            <result column="ORDER_YFMONEY" property="ORDER_YFMONEY"/>
            <result column="ORDER_SHOPMONEY" property="ORDER_SHOPMONEY"/>
            <result column="ARRIVE_TIME" property="ARRIVE_TIME"/>
            <result column="CREATE_TIME" property="CREATE_TIME"/>
            <result column="TABLES_PK" property="TABLES_PK"/>
            <result column="TABLES_NAME" property="TABLES_NAME"/>
            <result column="TABLES_NUM" property="TABLES_NUM"/>
            <result column="TABLES_SHORT_NAME" property="TABLES_SHORT_NAME"/>
               
            
            <!-- collection定义关联集合类型的属性封装规则
            offType:指定集合中的元素类型
            -->
            <collection property="orders" javaType="ArrayList" ofType="java.util.HashMap">
                <id column="ORDER_DETAILS_PK" property="ORDER_DETAILS_PK"/>
	            <result column="ORDER_DETAILS_GNAME" property="ORDER_DETAILS_GNAME"/>
	            <result column="ORDER_DETAILS_GMONEY" property="ORDER_DETAILS_GMONEY"/>
	            <result column="ORDER_DETAILS_FS" property="ORDER_DETAILS_FS"/>
            </collection>
      </resultMap>
	<!-- 根据订单详情id删除订单里某一种菜品 -->
	<delete id="deleteOrderDetailByORDER_DETAILS_PK" parameterMap="BaseParameterMap">
		UPDATE  SC_ORDER_DETAILS
		SET ORDER_DETAILS_GOODS_STATE = '3'
		WHERE ORDER_DETAILS_PK = #{ORDER_DETAILS_PK};
	</delete>

	<select id="countByExample" parameterMap="BaseParameterMap"
		resultMap="BaseResultMap">
		SELECT COUNT(ORDER_PK) as ORDER_COUNT FROM SC_ORDER WHERE
		str_to_date(CREATE_TIME,'%Y-%m-%d %H:%i') BETWEEN CONCAT_WS('',
		date_format(now(),'%y-%m-%d'), ' 00:00') AND CONCAT_WS('',
		date_format(now(),'%y-%m-%d'), ' 23:59');
	</select>

	<select id="checkIsExitByExample" parameterMap="BaseParameterMap"
		resultMap="BaseResultMap">
		SELECT COUNT(ORDER_PK) as ORDER_COUNT FROM SC_ORDER WHERE
		ORDER_CODE = #{ORDER_CODE};
	</select>

	<insert id="insertOrderInfo" parameterMap="BaseParameterMap">
		INSERT INTO SC_ORDER
		<trim prefix="(" suffix=")" suffixOverrides=",">
			ORDER_PK,
			ORDER_POSITION,
			ORDER_CODE,
			ORDER_RS,
			ORDER_PAY_STATE,
			ORDER_STATE,
			ARRIVE_TIME,
			FK_SHOP,
			CREATE_TIME,
			CREATE_BY
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			#{UUID},
			#{ORDER_POSITION},
			#{ORDER_CODE},
			#{ORDER_RS},
			'0',
			#{ORDER_STATE},
			#{ARRIVE_TIME},
			#{FK_SHOP},
			NOW(),
			#{CREATE_BY},
		</trim>
	</insert>
	
	<!-- 插入购物车订单信息，lps 2018年12月05日02:40:20 -->
		<insert id="insertCartOrderInfo" parameterMap="BaseParameterMap">
		INSERT INTO SC_ORDER
		<trim prefix="(" suffix=")" suffixOverrides=",">
			ORDER_PK,
			ORDER_POSITION,
			ORDER_CODE,
			ORDER_RS,
			ORDER_PAY_STATE,
			ORDER_STATE,
			ARRIVE_TIME,
			FK_USER,
			FK_SHOP,
			CREATE_TIME,
			CREATE_BY,
			ORDER_YFMONEY,
			ORDER_DIVISION
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			#{UUID},
			#{ORDER_POSITION},
			#{ORDER_CODE},
			#{ORDER_RS},
			'0',
			'3',
			NOW(),
			#{FK_USER},
			#{FK_SHOP},
			NOW(),
			#{CREATE_BY},
			#{ORDER_YFMONEY},
			#{ORDER_DIVISION}
		</trim>
	</insert>
	
	

	<insert id="insertOrderDeatilInfo" parameterMap="BaseParameterMap">
		INSERT INTO SC_ORDER_DETAILS
		<trim prefix="(" suffix=")" suffixOverrides=",">
			ORDER_DETAILS_PK,
			ORDER_DETAILS_GNAME,
			ORDER_DETAILS_FS,
			ORDER_DETAILS_GMONEY,
			FK_ORDER,
			ORDER_DETAILS_FORMAT,
			ORDER_DETAILS_TASTE,
			ORDER_DETAILS_MAKING,
			ORDER_DETAILS_DW,
			FK_GOODS,
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			#{UUID},
			#{GOODS_NAME},
			#{GOODS_NUM},
			#{GOODS_PRICE},
			#{FK_ORDER},
			#{GOODS_FORMAT},
			#{GOODS_TASTE},
			#{GOODS_MAKING},
			#{GOODS_DW},
			#{FK_GOODS},
		</trim>
	</insert>
	
	
	<!-- 插入订单里边的订单详情 lps 2018年12月05日02:48:25 -->
		<insert id="insertCartOrderDeatilInfo" parameterMap="BaseParameterMap">
		INSERT INTO SC_ORDER_DETAILS
		<trim prefix="(" suffix=")" suffixOverrides=",">
			ORDER_DETAILS_PK,
			ORDER_DETAILS_GNAME,
			ORDER_DETAILS_FS,
			ORDER_DETAILS_GMONEY,
			FK_ORDER,
			ORDER_DETAILS_FORMAT,
			ORDER_DETAILS_TASTE,
			ORDER_DETAILS_MAKING,
			ORDER_DETAILS_DW,
			FK_GOODS
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			#{UUID},
			#{ORDER_DETAILS_GNAME},
			#{ORDER_DETAILS_FS},
			#{ORDER_DETAILS_GMONEY},
			#{FK_ORDER},
			#{ORDER_DETAILS_FORMAT},
			#{ORDER_DETAILS_TASTE},
			#{ORDER_DETAILS_MAKING},
			#{ORDER_DETAILS_DW},
			#{FK_GOODS}
		</trim>
	</insert>
	
	
	
	
	<!-- 查询今日智慧云订单消费总金额 -->
	<select id="selectZHYMoney" parameterMap="BaseParameterMap" resultMap="BaseResultMap">
		SELECT o.ORDER_SHOPMONEY  FROM sc_order o WHERE str_to_date(o.CREATE_TIME,'%Y-%m-%d %H:%i:%s') 
			BETWEEN str_to_date(#{todayStart},'%Y-%m-%d %H:%i:%s') 
			AND str_to_date(#{todayEnd},'%Y-%m-%d %H:%i:%s')
			AND o.FK_SHOP = #{FK_SHOP}
			AND o.ORDER_DIVISION = '1'
			AND o.ORDER_PAY_STATE = '1'
	</select>
	<!-- 查询今日智慧云订单商品总份数 -->
	<select id="selectZHYOrderNumber" parameterMap="BaseParameterMap" resultMap="BaseResultMap">
		SELECT COUNT(od.ORDER_DETAILS_FS) AS ZHY_ORDER_NUMBER FROM sc_order o LEFT JOIN sc_order_details od
			ON o.ORDER_PK = od.FK_ORDER
			WHERE o.FK_SHOP = #{FK_SHOP}
			 AND str_to_date(o.CREATE_TIME,'%Y-%m-%d %H:%i:%s') 
			BETWEEN str_to_date(#{todayStart},'%Y-%m-%d %H:%i:%s') 
			AND str_to_date(#{todayEnd},'%Y-%m-%d %H:%i:%s')
	</select>
	<!-- 查询今日饿百订单消费总金额 -->
	<select id="selectEBMoney" parameterMap="BaseParameterMap" resultMap="BaseResultMap">
		SELECT eb.ORDER_SHOP_FEE FROM sc_waimai_eb_order eb
	 		WHERE str_to_date(eb.CREATE_TIME,'%Y-%m-%d %H:%i:%s') 
				BETWEEN str_to_date(#{todayStart},'%Y-%m-%d %H:%i:%s') 
				AND str_to_date(#{todayEnd},'%Y-%m-%d %H:%i:%s')
				AND eb.SHOP_BAIDU_ID = (SELECT s.EB_SHOP_ID  FROM sc_shop_info s 
					WHERE s.SHOP_ID = #{FK_SHOP})
	</select>
	<!-- 查询今日饿百订单商品总份数-->
	<select id="selectEBOrderNumber" parameterMap="BaseParameterMap" resultMap="BaseResultMap">
		SELECT COUNT(od.ORDER_DETAILS_FS) AS EB_ORDER_NUMBER FROM sc_waimai_eb_order eb 
			LEFT JOIN sc_order_details od ON eb.ORDER_PK = od.FK_ORDER 
			WHERE str_to_date(eb.CREATE_TIME,'%Y-%m-%d %H:%i:%s') 
					BETWEEN str_to_date(#{todayStart},'%Y-%m-%d %H:%i:%s') 
					AND str_to_date(#{todayEnd},'%Y-%m-%d %H:%i:%s')
					AND eb.SHOP_BAIDU_ID = (SELECT s.EB_SHOP_ID  FROM sc_shop_info s 
							WHERE s.SHOP_ID = #{FK_SHOP})
	</select>
	

	<select id="loadCountOrderWei" parameterMap="BaseParameterMap"
		resultMap="BaseResultMap">
		SELECT COUNT(ORDER_PK) as ORDER_COUNT FROM SC_ORDER WHERE
		ORDER_PAY_STATE = '0' AND ORDER_STATE = '2' AND FK_SHOP = #{FK_SHOP}
		AND CREATE_BY = #{FK_USER}
	</select>
<!-- 查询智慧云订单数据 -->
	<select id="selectZHYWMOrderData"  parameterMap="BaseParameterMap" resultMap="BaseResultMap">
			SELECT o.ORDER_PK,o.CREATE_TIME,o.ORDER_SHOPMONEY,o.WM_ORDER_USERNAME,o.WM_USERPHONE,
			o.WM_ORDER_DELIVERY_PARTY,
			(SELECT COUNT(od.ORDER_DETAILS_PK) FROM sc_order_details od
				WHERE od.FK_ORDER = o.ORDER_PK
			) AS GOODS_FS FROM sc_order o
				WHERE o.WM_ORDER_STATE = #{orderStatus}
				AND o.FK_SHOP = #{FK_SHOP}
				AND o.ORDER_DIVISION = '1'
				AND str_to_date(o.CREATE_TIME,'%Y-%m-%d %H:%i:%s') 
							BETWEEN str_to_date(#{startTime},'%Y-%m-%d %H:%i:%s') 
							AND str_to_date(#{endTime},'%Y-%m-%d %H:%i:%s')
	</select>
	<!-- 查询饿百外卖数据 -->
	<select id="selectEBWMOrderData" parameterMap="BaseParameterMap" resultMap="BaseResultMap">
		SELECT eo.ORDER_PK,eo.CREATE_TIME,
			eo.ORDER_SHOP_FEE AS ORDER_SHOPMONEY,
			eo.USER_NAME AS WM_ORDER_USERNAME,
			eo.USER_PHONE AS WM_USERPHONE,
			eo.ORDER_DELIVERY_PARTY AS WM_ORDER_DELIVERY_PARTY,
			(SELECT COUNT(od.ORDER_DETAILS_PK) FROM sc_order_details od
				WHERE od.FK_ORDER = eo.ORDER_PK
			) AS GOODS_FS
			FROM sc_waimai_eb_order eo
			WHERE eo.SHOP_BAIDU_ID  = (
				SELECT s.EB_SHOP_ID FROM sc_shop_info s
				WHERE s.SHOP_ID = #{FK_SHOP}
			)
			AND eo.ORDER_STATUS = #{orderStatus}
			AND eo.ORDER_FROM = #{ORDER_FROM}
			AND str_to_date(eo.CREATE_TIME,'%Y-%m-%d %H:%i:%s') 
				BETWEEN str_to_date(#{startTime},'%Y-%m-%d %H:%i:%s') 
				AND str_to_date(#{endTime},'%Y-%m-%d %H:%i:%s')
	</select>
	<!-- 查询智慧云订单状态的分别数量 -->
	<select id="loadZHYOrderNumber" parameterMap="BaseParameterMap" resultMap="BaseResultMap">
		SELECT o.WM_ORDER_STATE,COUNT(o.ORDER_PK) AS ORDER_NUMBER
				FROM sc_order o
				WHERE  o.FK_SHOP = #{FK_SHOP}
				AND o.ORDER_DIVISION = '1'
				AND str_to_date(o.CREATE_TIME,'%Y-%m-%d %H:%i:%s') 
					BETWEEN str_to_date(#{startTime},'%Y-%m-%d %H:%i:%s') 
					AND str_to_date(#{endTime},'%Y-%m-%d %H:%i:%s')
				GROUP BY o.WM_ORDER_STATE
	</select>
	<!-- 查询饿百订单状态的分别数量 -->
	<select id="loadEBOrderNumber" parameterMap="BaseParameterMap" resultMap="BaseResultMap">
		SELECT eo.ORDER_STATUS AS WM_ORDER_STATE,COUNT(eo.ORDER_PK) AS ORDER_NUMBER
			FROM sc_waimai_eb_order eo
			WHERE eo.SHOP_BAIDU_ID  = (
				SELECT s.EB_SHOP_ID FROM sc_shop_info s
				WHERE s.SHOP_ID = #{FK_SHOP}
			)
			AND eo.ORDER_FROM = #{ORDER_FROM}
			AND str_to_date(eo.CREATE_TIME,'%Y-%m-%d %H:%i:%s') 
				BETWEEN str_to_date(#{startTime},'%Y-%m-%d %H:%i:%s') 
				AND str_to_date(#{endTime},'%Y-%m-%d %H:%i:%s')
			GROUP BY eo.ORDER_STATUS
	</select>
	<resultMap id="wmOrderDetail" type="java.util.HashMap">
            <id column="ORDER_PK" property="ORDER_PK"/>
            <result column="ORDER_CODE" property="ORDER_CODE"/>
            <result column="CREATE_TIME" property="CREATE_TIME"/>
            <result column="WM_ORDER_SEND_TIME" property="WM_ORDER_SEND_TIME"/>
            <result column="WM_ORDER_SEND_FEE" property="WM_ORDER_SEND_FEE"/>
            <result column="WM_ORDER_PACKAGE_FEE" property="WM_ORDER_PACKAGE_FEE"/>
            <result column="ORDER_YHMONEY" property="ORDER_YHMONEY"/>
            <result column="ORDER_YFMONEY" property="ORDER_YFMONEY"/>
            <result column="ORDER_SHOPMONEY" property="ORDER_SHOPMONEY"/>
            <result column="WM_ORDER_REMARK" property="WM_ORDER_REMARK"/>
            <result column="WM_ORDER_USERNAME" property="WM_ORDER_USERNAME"/>
            <result column="WM_USERPHONE" property="WM_USERPHONE"/>
            <result column="WM_USER_ADDRESS" property="WM_USER_ADDRESS"/>
            <result column="WM_ORDER_STATE" property="WM_ORDER_STATE"/>
            <result column="WM_ORDER_DELIVERY_PARTY" property="WM_ORDER_DELIVERY_PARTY"/>
            <!-- collection定义关联集合类型的属性封装规则
            offType:指定集合中的元素类型
            -->
            <collection property="orderDetailList" javaType="ArrayList" ofType="java.util.HashMap">
                <id column="ORDER_DETAILS_PK" property="ORDER_DETAILS_PK"/>
	            <result column="ORDER_DETAILS_GNAME" property="ORDER_DETAILS_GNAME"/>
	            <result column="ORDER_DETAILS_GMONEY" property="ORDER_DETAILS_GMONEY"/>
	            <result column="ORDER_DETAILS_FS" property="ORDER_DETAILS_FS"/>
            </collection>
      </resultMap>
	<!-- 根据PK查询智慧云订单详情 -->
	<select id="selectZHYOrderDetailByPk" resultMap="wmOrderDetail">
		SELECT o.ORDER_PK,o.ORDER_CODE,o.CREATE_TIME,
		o.WM_ORDER_SEND_TIME,o.WM_ORDER_SEND_FEE,o.WM_ORDER_PACKAGE_FEE,
		od.ORDER_DETAILS_GNAME,od.ORDER_DETAILS_PK,od.ORDER_DETAILS_FS,
		od.ORDER_DETAILS_GMONEY,o.ORDER_YHMONEY,o.ORDER_YFMONEY,o.ORDER_SHOPMONEY,
		o.WM_ORDER_REMARK,o.WM_ORDER_USERNAME,o.WM_USERPHONE,o.WM_USER_ADDRESS,
		o.WM_ORDER_STATE,o.WM_ORDER_DELIVERY_PARTY
		FROM sc_order o 
		LEFT JOIN sc_order_details od
		ON o.ORDER_PK = od.FK_ORDER
		WHERE o.ORDER_PK = #{ORDER_PK}
	</select>
	
	
	<!-- 根据订单ID结账，多表修改，一起修改的是桌位使用状态置位0 -->
	<update id="updataSettleAccountsByOrderId" parameterMap="BaseParameterMap">
		UPDATE sc_tables t, sc_order o
		SET t.TABLES_ISUSE = 0, o.ORDER_PAY_WAY = #{ORDER_PAY_WAY}, o.ORDER_PAY_STATE = #{ORDER_PAY_STATE}, ORDER_MLMONEY = #{ORDER_MLMONEY}, ORDER_JFDXMONEY = #{ORDER_JFDXMONEY},
			ORDER_YHMONEY = #{ORDER_YHMONEY}, ORDER_SHOPMONEY = #{ORDER_SHOPMONEY}
		WHERE o.ORDER_PK = #{ORDER_PK} AND t.TABLES_PK = o.ORDER_POSITION;
	</update>
	
	<!-- 根据订单id增加或减少订单应付金额, -->
	<update id="updateOrderOrderYfmoneyByOrderId" parameterMap="BaseParameterMap">
		UPDATE sc_order SET ORDER_YFMONEY = ORDER_YFMONEY
			<if test="opera == '1'.toString()">
			+
			</if>
			<if test="opera == '0'.toString()">
			-
			</if>
			${operaMoney} WHERE ORDER_PK = #{ORDER_PK};
	 </update>
	
	
</mapper>