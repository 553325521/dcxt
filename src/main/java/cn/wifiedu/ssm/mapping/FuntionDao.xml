<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="funtionDao">
	<resultMap id="BaseResultMap" type="java.util.HashMap"></resultMap>
	<parameterMap id="BaseParameterMap" type="java.util.HashMap"></parameterMap>
	<!--查询一级菜单 -->
	<select id="loadFunctionListByUserRole" resultMap="BaseResultMap"
		parameterMap="BaseParameterMap">
		SELECT 
			b.FUNCTION_PK, b.FUNCTION_NAME, b.FUNCTION_URL, b.FUNCTION_ICON, b.FUNCTION_SORT
		FROM (
			SELECT 
				a.FK_FUNCTION
			FROM 
				SC_SHOP_ROLE_FUNCTION a 
			WHERE a.FK_SHOP = #{SHOP_ID} AND a.FK_ROLE = #{ROLE_ID}) fun_info
		LEFT JOIN SC_FUNCTION b 
		ON fun_info.FK_FUNCTION = b.FUNCTION_PK
		<where>
			<if test="fid != null">
				AND b.FUNCTION_PK_PID = #{fid}
			</if>
			<if test="fid == null">
				AND b.FUNCTION_PK_PID IS
				NULL
			</if>
			AND b.FUNCTION_SWITCH = 'on'
		</where>
		ORDER BY CONVERT(b.FUNCTION_SORT, SIGNED)
	</select>

	<!--查询一级菜单 -->
	<select id="findTopFunctions" resultMap="BaseResultMap"
		parameterMap="BaseParameterMap">
		SELECT FUNCTION_PK, FUNCTION_NAME, FUNCTION_URL,
		FUNCTION_ICON, FUNCTION_SORT
		FROM SC_FUNCTION
		WHERE FUNCTION_PK_PID IS
		NULL AND
		FUNCTION_SWITCH='on' ORDER BY CONVERT(FUNCTION_SORT, SIGNED)
	</select>

	<select id="findAllFunctionURL" resultMap="BaseResultMap"
		parameterMap="BaseParameterMap">
		SELECT FUNCTION_PK, FUNCTION_NAME, FUNCTION_URL,
		FUNCTION_ICON, FUNCTION_SORT
		FROM SC_FUNCTION
		WHERE
		FUNCTION_SWITCH='on' ORDER BY CONVERT(FUNCTION_SORT, SIGNED)
	</select>

	<!--查询功能数量 -->
	<select id="loadCountByPid" resultMap="BaseResultMap"
		parameterMap="BaseParameterMap">
		SELECT COUNT(FUNCTION_PK) as FUNCTION_SORT
		FROM SC_FUNCTION
		<where>
			<if test="FUNCTION_ISPID == '2'">
				FUNCTION_PK_PID IS NOT
				NULL
			</if>
			<if test="FUNCTION_ISPID == '1'">
				FUNCTION_PK_PID IS
				NULL
			</if>
		</where>
	</select>

	<insert id="insertFuntion" parameterMap="BaseParameterMap">
		insert into SC_FUNCTION
		(
		FUNCTION_PK,
		FUNCTION_NAME,
		FUNCTION_URL,
		FUNCTION_ICON,
		FUNCTION_SORT,
		<if test="FUNCTION_ISPID == '2'">
			FUNCTION_PK_PID,
		</if>
		FUNCTION_SWITCH,
		CREATE_BY,
		CREATE_TIME
		)
		values
		(
		#{UUID},
		#{FUNCTION_NAME},
		#{FUNCTION_URL},
		#{FUNCTION_ICON},
		#{FUNCTION_SORT},
		<if test="FUNCTION_ISPID == '2'">
			#{FUNCTION_PK_PID},
		</if>
		#{FUNCTION_SWITCH},
		#{CREATE_BY},
		#{CREATE_TIME}
		)
	</insert>

</mapper>