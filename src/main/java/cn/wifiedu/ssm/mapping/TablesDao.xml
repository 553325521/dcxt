<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="tables" >
  	<resultMap id="BaseResultMap" type="java.util.HashMap" ></resultMap>
 	<parameterMap id="BaseParameterMap" type="java.util.HashMap" ></parameterMap>
  
	<select id="selectTablesByAreaId" parameterMap="BaseParameterMap" resultMap="BaseResultMap">
		SELECT 
			TABLES_PK, TABLES_NAME, TABLES_NUM, TABLES_STATUS, TABLES_PXXH, TABLES_DESC
		FROM
			sc_tables
		WHERE
			TABLES_AREA_FK = #{TABLES_AREA_FK} ORDER BY CAST(TABLES_PXXH AS SIGNED integer);
	</select>
	
	<!-- 根绝桌位id删除指定桌位 -->
	<delete id="removeTablesById" parameterMap="BaseParameterMap">
		DELETE FROM 
			sc_tables
		WHERE
			TABLES_PK = #{TABLES_ID}
	</delete>
	  
	<select id="findTablesById" parameterMap="BaseParameterMap" resultMap="BaseResultMap">
		SELECT 
			TABLES_PK, TABLES_NAME, TABLES_NUM, TABLES_STATUS, TABLES_PXXH, TABLES_DESC
		FROM
			sc_tables
		WHERE
			TABLES_PK = #{TABLES_ID}
	</select>
	  
	<insert id="insertTables" parameterMap="BaseParameterMap">
		INSERT INTO sc_tables
		(
			TABLES_PK,
			TABLES_AREA_FK,
			TABLES_NAME,
			TABLES_NUM,
			TABLES_STATUS,
			TABLES_PXXH,
			TABLES_DESC,
			CREATE_TIME,
			CREATE_BY
		)
		VALUES
		(
			#{UUID},
			#{TABLES_AREA_FK},
			#{TABLES_NAME},
			#{TABLES_NUM},
			#{TABLES_STATUS},
			#{TABLES_PXXH},
			#{TABLES_DESC},
			NOW(),
			#{CREATE_BY}
		)
	
	</insert>
	
	<!-- 根绝ID修改指定桌位 -->
	<update id="updateTablesById" parameterMap="BaseParameterMap">
		UPDATE sc_tables SET TABLES_NAME = #{TABLES_NAME}, 
			TABLES_NUM = #{TABLES_NUM}, TABLES_STATUS = #{TABLES_STATUS},
			TABLES_PXXH = #{TABLES_PXXH},
			TABLES_DESC = #{TABLES_DESC},
			UPDATE_TIME = NOW(),
			UPDATE_BY = #{UPDATE_BY}
		WHERE 
			TABLES_AREA_PK = #{TABLES_ID}
	</update>
	
	<update id="updateTablesPxxhAddById" parameterMap="BaseParameterMap">
		UPDATE 
			sc_tables
		SET 
			TABLES_PXXH = CAST(TABLES_PXXH AS SIGNED integer) + 1 
		WHERE 
			TABLES_AREA_FK = #{TABLES_AREA_ID} 
		AND 
			CAST(TABLES_PXXH AS SIGNED integer) >= CAST(#{SMALL_TABLES_PXXH} AS SIGNED integer)
		<if test="BIG_TABLES_PXXH != null and BIG_TABLES_PXXH != ''">
			AND 
				CAST(TABLES_PXXH AS SIGNED integer) &lt; CAST(#{BIG_TABLES_PXXH} AS SIGNED integer)
		</if>
		;
	</update>
	
	<update id="updateTablesPxxhSubById" parameterMap="BaseParameterMap">
		UPDATE 
			sc_tables
		SET 
			TABLES_PXXH = CAST(TABLES_PXXH AS SIGNED integer) - 1 
		WHERE 
			TABLES_AREA_FK = #{TABLES_AREA_ID} 
		AND 
			CAST(TABLES_PXXH AS SIGNED integer) > CAST(#{SMALL_TABLES_PXXH} AS SIGNED integer)
		<if test="BIG_TABLES_PXXH != null and BIG_TABLES_PXXH != ''">
			AND 
				 CAST(TABLES_PXXH AS SIGNED integer) &lt;= CAST(#{BIG_TABLES_PXXH} AS SIGNED integer);
		</if>
		;
	</update>
	
	<select id="findTablesCountByAreaId" parameterMap="BaseParameterMap"  resultMap="BaseResultMap">
	
		SELECT COUNT(TABLES_PXXH) AS tables_count FROM sc_tables WHERE TABLES_AREA_FK = #{TABLES_AREA_ID};
	
	</select>
	
	
</mapper>