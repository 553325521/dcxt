<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mappep.dtd" >
<mapper namespace="progress" >
  <resultMap id="BaseResultMap" type="java.util.HashMap" ></resultMap>
  <parameterMap id="BaseParameterMap" type="java.util.HashMap" ></parameterMap>
 		<!--通过科研主键查询中期报告  -->
 		<select id="findProgressById" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
	 	select
	  		e.SC_EXPLORE_PK,
		 	e.STATUS,
		 	e.FK_EXPLORE_PETITION,
			e.FK_EXPLORE_REPORT,
			e.FK_PROJECT_ACHIEVE,
			p.EXPLORE_PROGRESS_PK,
			p.SPENTFUND,
			p.BOOK_NUMBER,
			p.THESIS_NUMBER,
			p.RESEARCH_NUMBER,
			p.WORK_PROGRESS,
			p.REPRESENT_RESULTS,
			to_char(p.CREATE_TIME,'yyyy-MM-dd') CREATE_TIME,
			p.SCHOOL_CHECK_OPINION,
			p.AREA_CHECK_OPINION,
			p.SCHOOL_CHECK_RESULT,
			p.AREA_CHECK_RESULT,
			to_char(p.SCHOOL_CHECK_TIME,'yyyy-MM-dd') SCHOOL_CHECK_TIME,
			to_char(p.AREA_CHECK_TIME,'yyyy-MM-dd') AREA_CHECK_TIME,
			(select USER_SN from SC_CORE.SC_USER where USER_PK=p.SCHOOL_CHECK_USER) SCHOOL_CHECK_USER,
			(select USER_SN from SC_CORE.SC_USER where USER_PK=p.AREA_CHECK_USER) AREA_CHECK_USER,
			p.RES_FILE_LINK_PK,
			p.FILE_NAME,
			p.EXT_NAME,
			p.FILE_PATH,
			p.FILE_ID
			from SC_EXPLORE_PROGRESS p,SC_EXPLORE e
		 where p.EXPLORE_PROGRESS_PK=e.FK_EXPLORE_PROGRESS
	     and e.SC_EXPLORE_PK=#{SC_EXPLORE_PK}	 	
	 	</select>
 		
 		
 		<!-- 添加中期报告 -->
 		<insert id="insertProgress" parameterMap="BaseParameterMap">
 			insert into SC_EXPLORE_PROGRESS
 				(	
					EXPLORE_PROGRESS_PK,
					SPENTFUND,
					BOOK_NUMBER,
					THESIS_NUMBER,
					RESEARCH_NUMBER,
					WORK_PROGRESS,
					REPRESENT_RESULTS,
					CREATE_TIME,
					RES_FILE_LINK_PK,
					FILE_NAME,
					EXT_NAME,
					FILE_PATH,
					FILE_ID,
					SCHOOL_CHECK_RESULT,
					AREA_CHECK_RESULT	
 				)
 			values
 				(
 					#{UUID},
 					#{SPENTFUND},
 					#{BOOK_NUMBER},
 					#{THESIS_NUMBER},
 					#{RESEARCH_NUMBER},
 					#{WORK_PROGRESS},
 					#{REPRESENT_RESULTS},
 					sysdate,
 					#{RES_FILE_LINK_PK,jdbcType=VARCHAR},
					#{FILE_NAME,jdbcType=VARCHAR},
					#{EXT_NAME,jdbcType=VARCHAR},
					#{FILE_PATH,jdbcType=VARCHAR},
					#{FILE_ID,jdbcType=VARCHAR},
 					'0',
 					'0'
 				)
 		</insert>
 		<!-- 修改中期报告 -->
 		<update id="updateProgress" parameterMap="BaseParameterMap">
 			update SC_EXPLORE_PROGRESS
			set 
				SPENTFUND=#{SPENTFUND},
				BOOK_NUMBER=#{BOOK_NUMBER},
				THESIS_NUMBER=#{THESIS_NUMBER},
				RESEARCH_NUMBER=#{RESEARCH_NUMBER},
				WORK_PROGRESS=#{WORK_PROGRESS},
				REPRESENT_RESULTS=#{REPRESENT_RESULTS},
				RES_FILE_LINK_PK=#{RES_FILE_LINK_PK,jdbcType=VARCHAR},
				FILE_NAME=#{FILE_NAME,jdbcType=VARCHAR},
				EXT_NAME=#{EXT_NAME,jdbcType=VARCHAR},
				FILE_PATH=#{FILE_PATH,jdbcType=VARCHAR},
				FILE_ID=#{FILE_ID,jdbcType=VARCHAR}
		where EXPLORE_PROGRESS_PK=#{EXPLORE_PROGRESS_PK}	
 		</update>
 		<!--通过科研主键查询中期研究成果  -->
 		<select id="findStageResultListBypk" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
 			select 
 				*
			from SC_EXPLORE_PROGRESS_STAGE
			where FK_EXPLORE=#{EXPLORE_PK}	
			and DELETE_FLAG=0	
 		</select>
 		
		<!-- 中期研究成果 -->
		<select id="findAchieveListByPk" resultMap="BaseResultMap" parameterMap="BaseParameterMap">
 			select 
 				*
			from SC_EXPLORE_PROGRESS_STAGE
			where FK_EXPLORE=#{EXPLORE_PK}	
			and DELETE_FLAG=0	
 		</select>
 		
		
 		<!-- 新增中期报告研究成果-->
 		<insert id="insertStageResult" parameterMap="BaseParameterMap">
 			insert into SC_EXPLORE_PROGRESS_STAGE
 				(	
					PROGRESS_STAGE_PK,
					STAGE_NAME,
					STAGE_TYPE,
					STAGE_AUTHER,
					STAGE_DEP,
					FK_EXPLORE	
 				)
 			values
 				(
 					#{UUID},
 					#{STAGE_NAME},
 					#{STAGE_TYPE},
 					#{STAGE_AUTHER},
 					#{STAGE_DEP},
 					#{SC_EXPLORE_PK}		
 				)
 		</insert>
 		
 		
 <!--删除中期研究成果  -->		
 	<update id="deleteStageResult" parameterMap="BaseParameterMap">
 		update SC_EXPLORE_PROGRESS_STAGE
			set 
				DELETE_FLAG=1
		where PROGRESS_STAGE_PK=#{PROGRESS_STAGE_PK}
		and FK_EXPLORE=#{SC_EXPLORE_PK}
 	</update>	
 		
 
	
	
 
</mapper>